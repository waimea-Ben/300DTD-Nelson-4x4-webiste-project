{% extends 'pages/base.jinja' %}

{% block title %}
Upcoming Trips
{% endblock %}

{% block content %}
<hr class="header-line">

{# -------------------------------------------------------------
   Upcoming Trips Page
   Displays a table of upcoming trips with join/leave options
   Includes extra info about what to bring and trip guidelines
------------------------------------------------------------- #}

<h1 id="upcoming-title">Upcoming Trips</h1>
<p>Join us on our next adventure around the top of the South Island! Browse upcoming trips and reserve your spot. All skill levels welcome - from beginners to experienced off-roaders.</p>

{# Trip table section #}
<div class="trip-card">
    <header>
        <h3>Available trips</h3>
        <p>Click on any trip name to see full details including interactive maps</p>
    </header>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Location</th>
                <th>Date</th>
                <th>Difficulty</th>
                <th>Join</th>
            </tr>
        </thead>
        <tbody>

            {# Loop over upcoming trips #}
            {% for trip in upcoming_trips %}
            <tr>
                <td>
                    {# Trip name link triggers overlay and map load #}
                    <a href="#" 
                       hx-get="/trip/{{trip.id}}" 
                       hx-target="#trip-info" 
                       hx-swap="outerHTML" 
                       hx-trigger="click"
                       onclick="openOverlay(); setTimeout(() => {loadMap(`{{ trip.meeting }}`, `{{ trip.location }}`)}, 50);">
                        {{ trip.name }}
                    </a>
                </td>
                <td>{{ trip.location }}</td>
                <td>{{ trip.date|nicedateshort }}</td>
                <td>{{ trip.grade }}</td>
                <td>
                    {# Join/Leave button form #}
                    <form method="post"
                          action="{% if trip.id in joined_trip_ids %}/unjoin-trip/{{ trip.id }}{% else %}/join-trip/{{ trip.id }}{% endif %}">
                        <button type="submit">
                            {% if trip.id in joined_trip_ids %}Leave{% else %}Join{% endif %}
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}

        </tbody>
    </table>
</div>

{# Additional info sections: what to bring and guidelines #}
<div id="upcoming-extras">

    <article id="What-to-bring">
        <header>
            <h4>What to bring</h4>
        </header>
        <ul>
            <li>Recovery gear (snatch strap, shackles, bow shackles)</li>
            <li>Winch or come-along (optional)</li>
            <li>First aid kit</li>
            <li>UHF radio (channel 20)</li>
            <li>Spare tire and repair kit</li>
            <li>food and water</li>
            <li>Warm clothing and rain gear</li>
            <li>Torch/headlamp with spare batteries</li>
        </ul>
    </article>

    <article id="guidelines">
        <header>
            <h4>Guidelines</h4>
        </header>
        <ul>
            <li>All participants must have a 4WD vehicle in good working condition.</li>
            <li>Follow all DOC and landowner rules</li>
            <li>Participants must carry the required gear and equipment listed above.</li>
            <li>Follow the instructions of the trip leader at all times.</li>
            <li>Adhere to the principles of Leave No Trace.</li>
            <li>Never lose sight of vehicle behind you.</li>
            <li>Ensure your vehicle is fueled and serviced before the trip.</li>
            <li>Inform the trip leader of any special requirements.</li>
        </ul>
    </article>

</div>
{% endblock %}
